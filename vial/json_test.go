package vial

import (
	"testing"
)

func TestNew(t *testing.T) {

	tests := []struct {
		expected string
		keymap   [][]string
	}{
		{
			keymap: [][]string{{"0", "1", "2"}, {"3", "4", "5"}},
			expected: "" +
				"000011112222\n" +
				"000011112222\n" +
				"000011112222\n" +
				"000011112222\n" +
				"333344445555\n" +
				"333344445555\n" +
				"333344445555\n" +
				"333344445555\n" +
				"",
		},
		{
			keymap: [][]string{{"0", "1", "2"}, {"3", "4", "5"}, {"6", "7", "8"}},
			expected: "" +
				"000011112222\n" +
				"000011112222\n" +
				"000011112222\n" +
				"000011112222\n" +
				"333344445555\n" +
				"333344445555\n" +
				"333344445555\n" +
				"333344445555\n" +
				"666677778888\n" +
				"666677778888\n" +
				"666677778888\n" +
				"666677778888\n" +
				"",
		},
		{
			keymap: [][]string{{`{"x":1}`, "1", "2"}, {"3", "4", "5"}},
			expected: "" +
				"    11112222\n" +
				"    11112222\n" +
				"    11112222\n" +
				"    11112222\n" +
				"333344445555\n" +
				"333344445555\n" +
				"333344445555\n" +
				"333344445555\n" +
				"",
		},
		{
			keymap: [][]string{{`{"x":1}`, "1", "2"}, {"3", `{"x":2}`, "5"}},
			expected: "" +
				"    11112222    \n" +
				"    11112222    \n" +
				"    11112222    \n" +
				"    11112222    \n" +
				"3333        5555\n" +
				"3333        5555\n" +
				"3333        5555\n" +
				"3333        5555\n" +
				"",
		},
		{
			keymap: [][]string{{`{"x":0.25}`, "1", "2"}},
			expected: "" +
				" 11112222\n" +
				" 11112222\n" +
				" 11112222\n" +
				" 11112222\n" +
				"",
		},
		{
			keymap: [][]string{{`{"x":0.5}`, "1", "2"}},
			expected: "" +
				"  11112222\n" +
				"  11112222\n" +
				"  11112222\n" +
				"  11112222\n" +
				"",
		},
		{
			keymap: [][]string{{`{"x":0.75}`, "1", "2"}},
			expected: "" +
				"   11112222\n" +
				"   11112222\n" +
				"   11112222\n" +
				"   11112222\n" +
				"",
		},
		{
			keymap: [][]string{{`{"x":1}`, "1", "2"}},
			expected: "" +
				"    11112222\n" +
				"    11112222\n" +
				"    11112222\n" +
				"    11112222\n" +
				"",
		},
		{
			keymap: [][]string{{"1", `{"x":1}`, "2"}, {"3", `{"x":1}`, "4"}},
			expected: "" +
				"1111    2222\n" +
				"1111    2222\n" +
				"1111    2222\n" +
				"1111    2222\n" +
				"3333    4444\n" +
				"3333    4444\n" +
				"3333    4444\n" +
				"3333    4444\n" +
				"",
		},
		{
			keymap: [][]string{{"1", `{"x":1}`, "3"}, {`{"x":1,"y":-0.75}`, "2"}},
			expected: "" +
				"1111    3333\n" +
				"111122223333\n" +
				"111122223333\n" +
				"111122223333\n" +
				"    2222    \n" +
				"",
		},
	}

	for i, test := range tests {
		v := NewJSON()
		v.SetKeymap(test.keymap)

		g, err := v.Draw()
		if err != nil {
			t.Errorf("error from v.Draw : %s", err.Error())
		}
		if g, e := g, test.expected; g != e {
			t.Errorf("%d: got\n%q\n want\n%q\n", i, g, e)
			t.Errorf("%d: got\n%s\n want\n%s\n", i, g, e)
		}
	}
}
